@startuml
actor user

participant pepper_efl
participant xdg_shell 
participant pepper
participant wayland_client

wayland_client->wayland_client : 1 : evas_object_del(win)

alt shell
wayland_client->xdg_shell : 2 : wl_surface_destroy()
xdg_shell->xdg_shell : 3 : wl_resource_destroy()
end alt

wayland_client->pepper : 4 : wl_surface_destroy()
pepper->pepper_efl : 5 : PEPPER_EVENT_OBJECT_DESTROY
pepper_efl->pepper_efl : 6 : _pepper_efl_surface_cb_destroy()

activate pepper_efl
pepper_efl-> user : 7 : evas_object_smart_callback_call (PEPPER_EFL_OBJ_DEL, obj)
deactivate pepper_efl

wayland_client->pepper : 8 : wl_buffer_destroy()
pepper->pepper_efl : 9 : PEPPER_EVENT_OBJECT_DESTROY
pepper_efl->pepper_efl : 10 : _pepper_efl_object_cb_buffer_destroy()

activate pepper_efl
pepper_efl->wayland_client : 11 : wl_shm_buffer_get_data()
wayland_client->pepper_efl : 12 : get shm buffer
pepper_efl->pepper_efl : 13 : copy shm buffer
pepper_efl->pepper_efl : 14 : evas_object_image_data_set(img, shm_buffer) 
deactivate pepper_efl 

user -> user : 15 : evas_objectl_del(obj)
user -> pepper_efl : 16 : smart callback for del\n_pepper_efl_smart_del()
pepper_efl-> pepper_efl : 17 : evas_object_del(img)
@enduml
